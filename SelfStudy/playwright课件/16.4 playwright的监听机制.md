接下来我们一起来了解如何在 Playwright 中监听浏览器的请求和响应数据。通过监听机制，我们可以获取到浏览器所有的请求和响应数据，从而实现数据采集、监控和调试等功能。Playwright 提供了强大的监听功能，包括请求监听和响应监听，可以大幅提高爬虫开发的效率。

### 16.4.1 请求监听
`page.on("request", 处理函数)` 方法用于监听浏览器的所有请求。每当浏览器发起一个请求时，处理函数会被调用，并传递一个 `request` 对象作为参数。通过这个对象，我们可以获取到请求的 URL、方法、头部信息等。

```python
def request_handler(request):
    """拦截浏览器请求"""
    print("请求的地址为：", request.url)
    print("请求的方法为：", request.method)
    print("请求的头部信息为：", request.headers)
    print("请求的资源类型为：", request.resource_type)

# 启动 Playwright 并打开一个新的浏览器实例
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)  # 设置 headless=False 可以看到浏览器界面
    page = browser.new_page()

    # 监听请求
    page.on("request", request_handler)

    page.goto("https://www.baidu.com")

    browser.close()
```

**详细说明**

+ `request.resource_type`: 获取请求的资源类型，如 document, stylesheet, image, media, font, script, texttrack, xhr, fetch, eventsource, websocket, manifest, other。
+ `request.url`: 获取请求的 URL。
+ `request.method`: 获取请求的方法，如 GET, POST 等。
+ `request.headers`: 获取请求的头部信息。

**注意事项**

+ 请求监听可以用于监控所有的网络请求，但需要注意性能问题，特别是在请求量较大的情况下。
+ 可以通过 `request.resource_type` 过滤特定类型的请求，如图片、脚本等

### 16.4.2 响应监听
`page.on("response", 处理函数) `方法用于监听浏览器的所有响应。每当浏览器收到一个响应时，处理函数会被调用，并传递一个 `response` 对象作为参数。通过这个对象，我们可以获取到响应的状态码、头部信息、响应体等。

```python
def response_handler(response):
    """拦截浏览器请求的响应数据"""
    # 判断一下这个响应的内容是否为图片
    if response.request.resource_type == 'image':
        print("响应的图片地址为：", response.url)
    else:
        print("响应的地址为：", response.url)
    # 获取响应的状态码
    print("响应的状态码为：", response.status)
    # 获取响应的头部信息
    print("响应的头部信息为：", response.headers)
    # 获取响应的文本内容
    if response.request.resource_type == 'document':
        print("响应的文本内容为：", response.text())

# 启动 Playwright 并打开一个新的浏览器实例
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)  # 设置 headless=False 可以看到浏览器界面
    page = browser.new_page()

    # 监听响应
    page.on("response", response_handler)

    page.goto("https://www.baidu.com")

    browser.close()

```

**详细说明**

+ `response.request`: 获取响应对应的请求对象。
+ `response.url`: 获取响应的 URL。
+ `response.status`: 获取响应的状态码。
+ `response.headers`: 获取响应的头部信息。
+ `response.text()`: 获取响应的文本内容。
+ `response.body()`: 获取响应的二进制内容。

**注意事项**

+ 响应监听可以用于获取所有的响应数据，但需要注意性能问题，特别是在响应量较大的情况下。
+ 可以通过 `response.request.resource_type` 过滤特定类型的响应，如文档、脚本等。







